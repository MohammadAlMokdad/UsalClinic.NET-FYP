@model UsalClinic.Web.ViewModels.ShiftViewModel

<style>
    /* Modal header with gradient background */
    .modal-header {
        background: linear-gradient(135deg, #5ddcff, #00a1cb, #007acc);
        color: white;
        font-weight: 700;
        border-bottom: none;
    }

    /* Modal title */
    .modal-title {
        font-size: 1.25rem;
    }

    /* Primary button */
    .btn-primary {
        background-color: #007acc;
        border-color: #007acc;
    }

        .btn-primary:hover,
        .btn-primary:focus {
            background-color: #005fa3;
            border-color: #005fa3;
            box-shadow: none;
        }

    /* Secondary button */
    .btn-secondary {
        background-color: #00a1cb;
        border-color: #00a1cb;
        color: white;
    }

        .btn-secondary:hover,
        .btn-secondary:focus {
            background-color: #007a99;
            border-color: #007a99;
            color: white;
            box-shadow: none;
        }

    /* Form labels inside modal */
    label {
        font-weight: 600;
        color: #005fa3;
    }
</style>

<form asp-action="Edit" method="post" novalidate>
    @Html.AntiForgeryToken()

    <div class="modal-header">
        <h5 class="modal-title" id="editModalLabel">Edit Shift</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>

    <div class="modal-body">
        <input type="hidden" asp-for="Id" />

        <div class="mb-3">
            <label asp-for="Role" class="form-label"></label>
            <select asp-for="Role" class="form-select" id="roleSelect">
                <option value="">-- Select Role --</option>
                <option value="Doctor" selected="@(Model.Role == "Doctor")">Doctor</option>
                <option value="Nurse" selected="@(Model.Role == "Nurse")">Nurse</option>
            </select>
            <span asp-validation-for="Role" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="StaffId" class="form-label"></label>
            <select asp-for="StaffId" name="StaffId" class="form-select" id="StaffId">
                <option value="">-- Select Name --</option>
                @if (ViewBag.StaffList != null)
                {
                    foreach (var staff in ViewBag.StaffList)
                    {
                        <option value="@staff.Value" selected="@(staff.Value == Model.StaffId)">
                            @staff.Text
                        </option>
                    }
                }
            </select>
            <span asp-validation-for="StaffId" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label class="form-label">Days of Week</label>
            <div>
                @foreach (DayOfWeek day in Enum.GetValues(typeof(DayOfWeek)))
                {
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="DaysOfWeek" value="@day" @(Model.DaysOfWeek.Contains(day) ? "checked" : "") />
                        <label class="form-check-label">@day</label>
                    </div>
                }
            </div>
            <span asp-validation-for="DaysOfWeek" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="StartTime" class="form-label">Start Time</label>
            <input asp-for="StartTime" class="form-control" type="time" />
            <span asp-validation-for="StartTime" class="text-danger"></span>
        </div>

        <div class="mb-3">
            <label asp-for="EndTime" class="form-label">End Time</label>
            <input asp-for="EndTime" class="form-control" type="time" />
            <span asp-validation-for="EndTime" class="text-danger"></span>
        </div>

        <div class="form-check mb-3">
            <input asp-for="IsRepeatingWeekly" class="form-check-input" />
            <label asp-for="IsRepeatingWeekly" class="form-check-label">Repeats Weekly</label>
        </div>
    </div>

    <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Save Changes</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
    </div>
</form>

@section Scripts {
    <script>
        function loadStaff(role, selectedId) {
            let url = role === 'Doctor' ? '/Shift/GetDoctors' : '/Shift/GetNurses';
            fetch(url)
                .then(res => res.json())
                .then(data => {
                    let staffSelect = document.getElementById('StaffId');
                    staffSelect.innerHTML = '<option value="">Select Staff</option>';
                    data.forEach(staff => {
                        let selected = staff.id == selectedId ? 'selected' : '';
                        staffSelect.innerHTML += `<option value="${staff.id}" ${selected}>${staff.name}</option>`;
                    });
                });
        }

        document.getElementById('roleSelect').addEventListener('change', function () {
            loadStaff(this.value);
        });

        document.addEventListener('DOMContentLoaded', function () {
            let role = '@Model.Role';
            let staffId = '@Model.StaffId';
            if (role) {
                document.getElementById('roleSelect').value = role;
                loadStaff(role, staffId);
            }
        });
    </script>
    <partial name="_ValidationScriptsPartial" />
}
